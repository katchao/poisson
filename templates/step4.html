
	<meta id="template_vars" targetw="{{ targetw }}" targeth="{{ targeth }}" half_region_height="{{ half_region_height }}" half_region_width="{{ half_region_width }}"
		another-data="{{ url_for('submit_offset') }}">

	<p><strong>Step 4:</strong> Choose where you want to paste your image.</p>

	<p> <img src="{{ url_for('uploaded_file', filename = '%s' % target_filename) }}" id="target" /></p>

	<form id="offsetform" enctype="multipart/form-data">
	</form>

	<p><div id="coordinates"></div></p>

	<script>
		$(function() {
			// get variables
			var targetw = Number($("#template_vars").attr('targetw'));
			var targeth = Number($("#template_vars").attr('targeth'));
			var half_region_width = Number($("#template_vars").attr('half_region_width'));
			var half_region_height = Number($("#template_vars").attr('half_region_height'));
			var offY;
			var offX;


			// gets coordinates from click on image
			function getCoords(e, image) {
				var offset = $(image).offset();
				offY = Math.floor(e.pageX - offset.left);
				offX = Math.floor(e.pageY - offset.top);
				return [offY, offX];
			};


			// checks if user defined coordinates are valid
			function check_offsets(offX, offY, targetw, targeth, half_region_height, half_region_width) {
				if((offX + half_region_height > targeth-1) || (offY + half_region_width > targetw-1) || (offX - half_region_height < 0) || (offY - half_region_width < 0)) {
					return false;
				}
				return true;
			}


			$("#target").click(function(e) {
				// get coordinates of click from image
				offsetCoords = getCoords(e, this);
				offY = offsetCoords[0];
				offX = offsetCoords[1];

				// check coordinates
				var flag = check_offsets(offX, offY, targetw, targeth, half_region_height, half_region_width);

				if(!flag) {
					alert("Please choose another set of offsets.");
				} else { // offsets okay
					$('#offsetform').submit();
				}
			});

			// submit button function
			$('#offsetform').submit(function(e) {
				e.preventDefault();

		    	// process the form
    			$.ajax({
        			type: 'POST',
        			url: '/submit_offset', // the url where we want to POST
        			data: { offY: offY, offX: offX },
        			cache: false,
    			})
    			.done(function(data) {
    				$('#main-content').html(data);
    			});

    			return false;
			});
		});
	</script>
	